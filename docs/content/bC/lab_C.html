
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Hands-on &#8212; A course on Geographic Data Science</title>
    
  <link rel="stylesheet" href="../../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Do-It-Yourself" href="diy_C.html" />
    <link rel="prev" title="Concepts" href="concepts_C.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  
  <h1 class="site-logo" id="site-title">A course on Geographic Data Science</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Information
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../infrastructure.html">
   Infrastructure
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../assessment.html">
   Assessment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../datasets.html">
   Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bibliography.html">
   Bibliography
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  A - Introduction
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bA/concepts_A.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bA/lab_A.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bA/diy_A.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  B - Open Science
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bB/concepts_B.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bB/lab_B.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bB/diy_B.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  C - Spatial Data
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="concepts_C.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="diy_C.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  D - Mapping Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bD/concepts_D.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bD/lab_D.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bD/diy_D.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  E - Spatial Weights
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bE/concepts_E.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bE/lab_E.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bE/diy_E.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  F - ESDA
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bF/concepts_F.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bF/lab_F.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bF/diy_F.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  G - Clustering
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bG/concepts_G.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bG/lab_G.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bG/diy_G.html">
   Do-It-Yourself
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  H - Points
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../bH/concepts_H.html">
   Concepts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bH/lab_H.html">
   Hands-on
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../bH/diy_H.html">
   Do-It-Yourself
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/content/bC/lab_C.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/darribas/gds_course/master?urlpath=tree/content/bC/lab_C.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mapping-in-python">
   Mapping in Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#datasets">
   Datasets
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#cities">
     Cities
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#streets">
     Streets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bars">
     Bars
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspecting-spatial-data">
   Inspecting spatial data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#polygons">
     Polygons
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lines">
     Lines
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#points">
     Points
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#styling-plots">
   Styling plots
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-transparency">
     Changing transparency
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removing-axes">
     Removing axes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#adding-a-title">
     Adding a title
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#changing-the-size-of-the-map">
     Changing the size of the map
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#modifying-borders">
     Modifying borders
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transforming-crs">
     Transforming CRS
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#composing-multi-layer-maps">
   Composing multi-layer maps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-maps-to-figures">
   Saving maps to figures
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#manipulating-spatial-tables-geodataframes">
   Manipulating spatial tables (
   <code class="docutils literal notranslate">
    <span class="pre">
     GeoDataFrames
    </span>
   </code>
   )
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#area-calculation">
     Area calculation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#length">
     Length
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#centroid-calculation">
     Centroid calculation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#point-in-polygon-pip">
     Point in polygon (PiP)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#buffers">
     Buffers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#adding-base-layers-from-web-sources">
   Adding base layers from web sources
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interactive-maps">
   Interactive maps
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#further-resources">
   Further resources
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="hands-on">
<h1>Hands-on<a class="headerlink" href="#hands-on" title="Permalink to this headline">¶</a></h1>
<div class="section" id="mapping-in-python">
<h2>Mapping in Python<a class="headerlink" href="#mapping-in-python" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">osmnx</span>
<span class="kn">import</span> <span class="nn">contextily</span> <span class="k">as</span> <span class="nn">cx</span>
<span class="kn">from</span> <span class="nn">keplergl</span> <span class="kn">import</span> <span class="n">KeplerGl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>In this lab, we will learn how to load, manipulate and visualize spatial data. In some senses, spatial data are usually included simply as “one more column” in a table. However, <em>spatial is special</em> sometimes and there are few aspects in which geographic data differ from standard numerical tables. In this session, we will extend the skills developed in the <a class="reference internal" href="../bB/lab_B.html"><span class="doc std std-doc">previous one</span></a> about non-spatial data, and combine them. In the process, we will discover that, although with some particularities, dealing with spatial data in Python largely resembles dealing with non-spatial data.</p>
</div>
<div class="section" id="datasets">
<h2>Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h2>
<p>To learn these concepts, we will be playing with three main datasets. Same as in the <a class="reference internal" href="../bB/lab_B.html"><span class="doc std std-doc">previous block</span></a>, these datasets can be loaded dynamically from the web, or you can download them manually, keep a copy on your computer, and load them from there.</p>
<div class="admonition-important admonition">
<p class="admonition-title">Important</p>
<p>Make sure you are connected to the internet when you run these cells as they need to access data hosted online</p>
</div>
<div class="section" id="cities">
<h3>Cities<a class="headerlink" href="#cities" title="Permalink to this headline">¶</a></h3>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This dataset is derived from <a class="bibtex reference internal" href="../bibliography.html#arribas2019building" id="id1">[ABGLopezVM19]</a>, which proposes a machine learning algorithm to delineate city boundaries from building footprints.</p>
</div>
</div>
<p>First we will use a polygon geography. We will use an open dataset that contains the boundaries of Spanish cities. We can read it into an object named <code class="docutils literal notranslate"><span class="pre">cities</span></code> by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;https://ndownloader.figshare.com/files/20232174&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="streets">
<span id="lab-c-streets"></span><h3>Streets<a class="headerlink" href="#streets" title="Permalink to this headline">¶</a></h3>
<div class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This dataset froms of a project called “Las calles de las mujeres”, a community-driven initiative exploring the extent to which streets are named after women.</p>
<p>Check out more about the project, including an interactive map at:</p>
<blockquote>
<div><p><a class="reference external" href="https://geochicasosm.github.io/lascallesdelasmujeres/">https://geochicasosm.github.io/lascallesdelasmujeres/</a></p>
</div></blockquote>
</div>
</div>
<p>In addition to polygons, we will play with a line layer. For that, we are going to use a subset of street network from the Spanish city of Zaragoza.</p>
<p>The data is available on the following web address:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;https://github.com/geochicasosm/lascallesdelasmujeres&quot;</span>\
       <span class="s2">&quot;/raw/master/data/zaragoza/final_tile.geojson&quot;</span><span class="p">)</span>
<span class="n">url</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;https://github.com/geochicasosm/lascallesdelasmujeres/raw/master/data/zaragoza/final_tile.geojson&#39;
</pre></div>
</div>
</div>
</div>
<p>And you can read it into an object called <code class="docutils literal notranslate"><span class="pre">streets</span></code> with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">streets</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bars">
<h3>Bars<a class="headerlink" href="#bars" title="Permalink to this headline">¶</a></h3>
<p>The final dataset we will rely on is a set of points demarcating the location of bars in Zaragoza. To obtain it, we will use <code class="docutils literal notranslate"><span class="pre">osmnx</span></code>, a Python library that allows us to query <a class="reference external" href="https://www.openstreetmap.org">OpenStreetMap</a>. Note that we use the method <code class="docutils literal notranslate"><span class="pre">pois_from_place</span></code>, which queries for points of interest (POIs, or <code class="docutils literal notranslate"><span class="pre">pois</span></code>) in a particular place (Zaragoza in this case). In addition, we can specify a set of tags to delimit the query. We use this to ask <em>only</em> for amenities of the type “bar”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pois</span> <span class="o">=</span> <span class="n">osmnx</span><span class="o">.</span><span class="n">pois</span><span class="o">.</span><span class="n">pois_from_place</span><span class="p">(</span><span class="s2">&quot;Zaragoza, Spain&quot;</span><span class="p">,</span> 
                                  <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;amenity&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>
                                 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You do not need to know at this point what happens behind the scenes when we run <code class="docutils literal notranslate"><span class="pre">pois_from_place</span></code> but, if you are curious, we are making a query to <a class="reference external" href="https://www.openstreetmap.org">OpenStreetMap</a> (almost as if you typed “bars in Zaragoza, Spain” within Google Maps) and getting the response as a table of data, instead of as a website with an interactive map. Pretty cool, huh?</p>
</div>
</div>
<div class="section" id="inspecting-spatial-data">
<h2>Inspecting spatial data<a class="headerlink" href="#inspecting-spatial-data" title="Permalink to this headline">¶</a></h2>
<p>The most direct way to get from a file to a quick visualization of the data is by loading it as a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> and calling the <code class="docutils literal notranslate"><span class="pre">plot</span></code> command. The main library employed for all of this is <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> which is a geospatial extension of the <code class="docutils literal notranslate"><span class="pre">pandas</span></code> library, already introduced before. <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> supports the same functionality that <code class="docutils literal notranslate"><span class="pre">pandas</span></code> does, plus a wide range of spatial extensions that make manipulation and general “munging” of spatial data similar to non-spatial tables.</p>
<p>In two lines of code, we will obtain a graphical representation of the spatial data contained in a file that can be in many formats; actually, since it uses the same drivers under the hood, you can load pretty much the same kind of vector files that Desktop GIS packages like QGIS permit. Let us start by plotting single layers in a crude but quick form, and we will build style and sophistication into our plots later on.</p>
<div class="section" id="polygons">
<h3>Polygons<a class="headerlink" href="#polygons" title="Permalink to this headline">¶</a></h3>
<p>Now <code class="docutils literal notranslate"><span class="pre">lsoas</span></code> is a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>. Very similar to a traditional, non-spatial <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>, but with an additional column called <code class="docutils literal notranslate"><span class="pre">geometry</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city_id</th>
      <th>n_buildings</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ci000</td>
      <td>2348</td>
      <td>POLYGON ((385390.071 4202949.446, 384488.697 4...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ci001</td>
      <td>2741</td>
      <td>POLYGON ((214893.033 4579137.558, 215258.185 4...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ci002</td>
      <td>5472</td>
      <td>POLYGON ((690674.281 4182188.538, 691047.526 4...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ci003</td>
      <td>14608</td>
      <td>POLYGON ((513378.282 4072327.639, 513408.853 4...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ci004</td>
      <td>2324</td>
      <td>POLYGON ((206989.081 4129478.031, 207275.702 4...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This allows us to quickly produce a plot by executing the following line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_21_1.png" src="../../_images/lab_C_21_1.png" />
</div>
</div>
<p>This might not be the most aesthetically pleasant visual representation of the LSOAs geography, but it is hard to argue it is not quick to produce. We will work on styling and customizing spatial plots later on.</p>
<p><strong>Pro-tip</strong>: if you call a single row of the <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column, it’ll return a small plot ith the shape:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_24_0.svg" src="../../_images/lab_C_24_0.svg" /></div>
</div>
</div>
<div class="section" id="lines">
<h3>Lines<a class="headerlink" href="#lines" title="Permalink to this headline">¶</a></h3>
<p>Similarly to the polygon case, if we pick the <code class="docutils literal notranslate"><span class="pre">&quot;geometry&quot;</span></code> column of a table with lines, a single row will display the geometry as well:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">streets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_27_0.svg" src="../../_images/lab_C_27_0.svg" /></div>
</div>
<p>A quick plot is similarly generated by:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">streets</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_29_1.png" src="../../_images/lab_C_29_1.png" />
</div>
</div>
<p>Again, this is not the prettiest way to display the streets maybe, and you might want to change a few parameters such as colors, etc. All of this is possible, as we will see below, but this gives us a quick check of what lines look like.</p>
</div>
<div class="section" id="points">
<h3>Points<a class="headerlink" href="#points" title="Permalink to this headline">¶</a></h3>
<p>Points take a similar approach for quick plotting:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pois</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_33_1.png" src="../../_images/lab_C_33_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="styling-plots">
<h2>Styling plots<a class="headerlink" href="#styling-plots" title="Permalink to this headline">¶</a></h2>
<p>It is possible to tweak several aspects of a plot to customize if to particular needs. In this section, we will explore some of the basic elements that will allow us to obtain more compelling maps.</p>
<p><strong>NOTE</strong>: some of these variations are very straightforward while others are more intricate and require tinkering with the internal parts of a plot. They are not necessarily organized by increasing level of complexity.</p>
<div class="section" id="changing-transparency">
<h3>Changing transparency<a class="headerlink" href="#changing-transparency" title="Permalink to this headline">¶</a></h3>
<p>The intensity of color of a polygon can be easily changed through the <code class="docutils literal notranslate"><span class="pre">alpha</span></code> attribute in plot. This is specified as a value betwee zero and one, where the former is entirely transparent while the latter is the fully opaque (maximum intensity):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pois</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_38_1.png" src="../../_images/lab_C_38_1.png" />
</div>
</div>
</div>
<div class="section" id="removing-axes">
<h3>Removing axes<a class="headerlink" href="#removing-axes" title="Permalink to this headline">¶</a></h3>
<p>Although in some cases, the axes can be useful to obtain context, most of the times maps look and feel better without them. Removing the axes involves wrapping the plot into a figure, which takes a few more lines of aparently useless code but that, in time, it will allow you to tweak the map further and to create much more flexible designs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Plot layer of polygons on the axis</span>
<span class="n">cities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Remove axis frames</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
<span class="c1"># Display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_41_0.png" src="../../_images/lab_C_41_0.png" />
</div>
</div>
<p>Let us stop for a second a study each of the previous lines:</p>
<ol class="simple">
<li><p>We have first created a figure named <code class="docutils literal notranslate"><span class="pre">f</span></code> with one axis named <code class="docutils literal notranslate"><span class="pre">ax</span></code> by using the command <code class="docutils literal notranslate"><span class="pre">plt.subplots</span></code> (part of the library <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>, which we have imported at the top of the notebook). Note how the method is returning two elements and we can assign each of them to objects with different name (<code class="docutils literal notranslate"><span class="pre">f</span></code> and <code class="docutils literal notranslate"><span class="pre">ax</span></code>) by simply listing them at the front of the line, separated by commas.</p></li>
<li><p>Second, we plot the geographies as before, but this time we tell the function that we want it to draw the polygons on the axis we are passing, <code class="docutils literal notranslate"><span class="pre">ax</span></code>. This method returns the axis with the geographies in them, so we make sure to store it on an object with the same name, <code class="docutils literal notranslate"><span class="pre">ax</span></code>.</p></li>
<li><p>On the third line, we effectively remove the box with coordinates.</p></li>
<li><p>Finally, we draw the entire plot by calling <code class="docutils literal notranslate"><span class="pre">plt.show()</span></code>.</p></li>
</ol>
</div>
<div class="section" id="adding-a-title">
<h3>Adding a title<a class="headerlink" href="#adding-a-title" title="Permalink to this headline">¶</a></h3>
<p>Adding a title is an extra line, if we are creating the plot within a figure, as we just did. To include text on top of the figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add layer of polygons on the axis</span>
<span class="n">streets</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Add figure title</span>
<span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Streets in Zaragoza&quot;</span><span class="p">)</span>
<span class="c1"># Display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_45_0.png" src="../../_images/lab_C_45_0.png" />
</div>
</div>
</div>
<div class="section" id="changing-the-size-of-the-map">
<h3>Changing the size of the map<a class="headerlink" href="#changing-the-size-of-the-map" title="Permalink to this headline">¶</a></h3>
<p>The size of the plot is changed equally easily in this context. The only difference is that it is specified when we create the figure with the argument <code class="docutils literal notranslate"><span class="pre">figsize</span></code>. The first number represents the width, the X axis, and the second corresponds with the height, the Y axis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis with different size</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Add layer of polygons on the axis</span>
<span class="n">cities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="c1"># Display</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_48_0.png" src="../../_images/lab_C_48_0.png" />
</div>
</div>
</div>
<div class="section" id="modifying-borders">
<h3>Modifying borders<a class="headerlink" href="#modifying-borders" title="Permalink to this headline">¶</a></h3>
<p>Border lines sometimes can distort or impede proper interpretation of a map. In those cases, it is useful to know how they can be modified. Although not too complicated, the way to access borders in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> is not as straightforward as it is the case for other aspects of the map, such as size or frame. Let us first see the code to make the <em>lines thicker</em> and <em>black</em>, and then we will work our way through the different steps:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="c1"># Add layer of polygons on the axis, set fill color (`facecolor`) and boundary</span>
<span class="c1"># color (`edgecolor`)</span>
<span class="n">cities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
            <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
           <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_51_1.png" src="../../_images/lab_C_51_1.png" />
</div>
</div>
<p>Note how the lines are thicker. In addition, all the polygons are colored in the same (default) color, light red. However, because the lines are thicker, we can only see the polygon filling for those cities with an area large enough.</p>
<p>Let us examine line by line what we are doing in the code snippet:</p>
<ul class="simple">
<li><p>We begin by creating the figure (<code class="docutils literal notranslate"><span class="pre">f</span></code>) object and one axis inside it (<code class="docutils literal notranslate"><span class="pre">ax</span></code>) where we will plot the map.</p></li>
<li><p>Then, we call <code class="docutils literal notranslate"><span class="pre">plot</span></code> as usual, but pass in two new arguments: <code class="docutils literal notranslate"><span class="pre">linewidth</span></code> for the width of the line; <code class="docutils literal notranslate"><span class="pre">facecolor</span></code>, to control the color each polygon is filled with; and <code class="docutils literal notranslate"><span class="pre">edgecolor</span></code>, to control the color of the boundary.</p></li>
</ul>
<p>This approach works very similarly with other geometries, such as lines. For example, if we wanted to plot the streets in red, we would simply:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add layer with lines, set them red and with different line width</span>
<span class="c1"># and append it to the axis `ax`</span>
<span class="n">streets</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_53_1.png" src="../../_images/lab_C_53_1.png" />
</div>
</div>
<p>Important, note that in the case of lines the parameter to control the color is simply <code class="docutils literal notranslate"><span class="pre">color</span></code>. This is because lines do not have an area, so there is no need to distinguish between the main area (<code class="docutils literal notranslate"><span class="pre">facecolor</span></code>) and the border lines (<code class="docutils literal notranslate"><span class="pre">edgecolor</span></code>).</p>
</div>
<div class="section" id="transforming-crs">
<span id="lab-c-to-crs"></span><h3>Transforming CRS<a class="headerlink" href="#transforming-crs" title="Permalink to this headline">¶</a></h3>
<p>The coordindate reference system (CRS) is the way geographers and cartographers have to represent a three-dimentional object, such as the round earth, on a two-dimensional plane, such as a piece of paper or a computer screen. If the source data contain information on the CRS of the data, we can modify this in a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>. First let us check if we have the information stored properly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Projected CRS: EPSG:25830&gt;
Name: ETRS89 / UTM zone 30N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Europe - 6°W to 0°W and ETRS89 by country
- bounds: (-6.0, 35.26, 0.0, 80.53)
Coordinate Operation:
- name: UTM zone 30N
- method: Transverse Mercator
Datum: European Terrestrial Reference System 1989
- Ellipsoid: GRS 1980
- Prime Meridian: Greenwich
</pre></div>
</div>
</div>
</div>
<p>As we can see, there is information stored about the reference system: it is using the standard Spanish projection, which is expressed in meters. There are also other less decipherable parameters but we do not need to worry about them right now.</p>
<p>If we want to modify this and “reproject” the polygons into a different CRS, the quickest way is to find the <a class="reference external" href="https://en.wikipedia.org/wiki/International_Association_of_Oil_%26_Gas_Producers#European_Petroleum_Survey_Group">EPSG</a> code online (<a class="reference external" href="http://epsg.io/">epsg.io</a> is a good one, although there are others too). For example, if we wanted to transform the dataset into lat/lon coordinates, we would use its EPSG code, 4326:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reproject (`to_crs`) and plot (`plot`) polygons</span>
<span class="n">cities</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Set equal axis</span>
<span class="n">lims</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_59_0.png" src="../../_images/lab_C_59_0.png" />
</div>
</div>
<p>The shape of the polygons is slightly different. Furthermore, note how the <em>scale</em> in which they are plotted differs.</p>
</div>
</div>
<div class="section" id="composing-multi-layer-maps">
<h2>Composing multi-layer maps<a class="headerlink" href="#composing-multi-layer-maps" title="Permalink to this headline">¶</a></h2>
<p>So far we have considered many aspects of plotting <em>a single</em> layer of data. However, in many cases, an effective map will require more than one: for example we might want to display streets on top of the polygons of neighborhoods, and add a few points for specific locations we want to highlight. At the very heart of GIS is the possibility to combine spatial information from different sources by overlaying it on top of each other, and this is fully supported in Python.</p>
<p>For this section, let’s select only Zaragoza from the <code class="docutils literal notranslate"><span class="pre">streets</span></code> table and convert it to lat/lon so it’s aligned with the streets and POIs layers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zgz</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">112</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>
<span class="n">zgz</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>city_id</th>
      <th>n_buildings</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>112</th>
      <td>ci122</td>
      <td>23604</td>
      <td>POLYGON ((-0.93057 41.60615, -0.93092 41.60622...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Combining different layers on a single map boils down to adding each of them to the same axis in a sequential way, as if we were literally overlaying one on top of the previous one. For example, let’s plot the boundary of Zaragoza and its bars:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add a layer with polygon on to axis `ax`</span>
<span class="n">zgz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
<span class="c1"># Add a layer with lines on top in axis `ax`</span>
<span class="n">pois</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_65_1.png" src="../../_images/lab_C_65_1.png" />
</div>
</div>
</div>
<div class="section" id="saving-maps-to-figures">
<h2>Saving maps to figures<a class="headerlink" href="#saving-maps-to-figures" title="Permalink to this headline">¶</a></h2>
<p>Once we have produced a map we are content with, we might want to save it to a file so we can include it into a report, article, website, etc. Exporting maps in Python involves replacing <code class="docutils literal notranslate"><span class="pre">plt.show</span></code> by <code class="docutils literal notranslate"><span class="pre">plt.savefig</span></code> at the end of the code block to specify where and how to save it. For example to save the previous map into a <code class="docutils literal notranslate"><span class="pre">png</span></code> file in the same folder where the notebook is hosted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add a layer with polygon on to axis `ax`</span>
<span class="n">zgz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
<span class="c1"># Add a layer with lines on top in axis `ax`</span>
<span class="n">pois</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="c1"># Save figure to a PNG file</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;zaragoza_bars.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_68_0.png" src="../../_images/lab_C_68_0.png" />
</div>
</div>
<p>If you now check on the folder, you’ll find a <code class="docutils literal notranslate"><span class="pre">png</span></code> (image) file with the map.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">plt.savefig</span></code> contains a large number of options and additional parameters to tweak. Given the size of the figure created is not very large, we can increase this with the argument <code class="docutils literal notranslate"><span class="pre">dpi</span></code>, which stands for “dots per inch” and it’s a standard measure of resolution in images. For example, for a high quality image, we could use 500:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup figure and axis</span>
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add a layer with polygon on to axis `ax`</span>
<span class="n">zgz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">)</span>
<span class="c1"># Add a layer with lines on top in axis `ax`</span>
<span class="n">pois</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
<span class="c1"># Save figure to a PNG file</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;zaragoza_bars.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_70_0.png" src="../../_images/lab_C_70_0.png" />
</div>
</div>
</div>
<div class="section" id="manipulating-spatial-tables-geodataframes">
<h2>Manipulating spatial tables (<code class="docutils literal notranslate"><span class="pre">GeoDataFrames</span></code>)<a class="headerlink" href="#manipulating-spatial-tables-geodataframes" title="Permalink to this headline">¶</a></h2>
<p>Once we have an understanding of how to visually display spatial information contained, let us see how it can be combined with the operations learnt in the previous session about manipulating non-spatial tabular data. Essentially, the key is to realize that a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> contains most of its spatial information in a single column named <code class="docutils literal notranslate"><span class="pre">geometry</span></code>, but the rest of it looks and behaves exactly like a non-spatial <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> (in fact, it is). This concedes them all the flexibility and convenience that we saw in manipulating, slicing, and transforming tabular data, with the bonus that spatial data is carried away in all those steps. In addition, <code class="docutils literal notranslate"><span class="pre">GeoDataFrames</span></code> also incorporate a set of explicitly spatial operations to combine and transform data. In this section, we will consider both.</p>
<p><code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>s come with a whole range of traditional GIS operations built-in. Here we will run through a small subset of them that contains some of the most commonly used ones.</p>
<div class="section" id="area-calculation">
<h3>Area calculation<a class="headerlink" href="#area-calculation" title="Permalink to this headline">¶</a></h3>
<p>One of the spatial aspects we often need from polygons is their area. “How big is it?” is a question that always haunts us when we think of countries, regions, or cities. To obtain area measurements, first make sure you <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> <a class="reference internal" href="#lab-c-to-crs"><span class="std std-ref">is projected</span></a>. If that is the case, you can calculate areas as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">city_areas</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">area</span>
<span class="n">city_areas</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    8.449666e+06
1    9.121270e+06
2    1.322653e+07
3    6.808121e+07
4    1.072284e+07
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This indicates that the area of the first city in our table takes up 8,450,000 squared metres. If we wanted to convert into squared kilometres, we can divide by 1,000,000:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">areas_in_sqkm</span> <span class="o">=</span> <span class="n">city_areas</span> <span class="o">/</span> <span class="mi">1000000</span>
<span class="n">areas_in_sqkm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     8.449666
1     9.121270
2    13.226528
3    68.081212
4    10.722843
dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="length">
<span id="lab-c-length"></span><h3>Length<a class="headerlink" href="#length" title="Permalink to this headline">¶</a></h3>
<p>Similarly, an equally common question with lines is their length. Also similarly, their computation is relatively straightforward in Python, provided that our data are projected. Here we will perform the projection (<code class="docutils literal notranslate"><span class="pre">to_crs</span></code>) and the calculation of the length at the same time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">street_length</span> <span class="o">=</span> <span class="n">streets</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">25830</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="n">street_length</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     37.338828
1    104.510732
2    365.969719
3     97.101436
4     94.002218
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Since the CRS we use (<code class="docutils literal notranslate"><span class="pre">EPSG:25830</span></code>) is expressed in metres, we can tell the first street segment is about 37m.</p>
</div>
<div class="section" id="centroid-calculation">
<h3>Centroid calculation<a class="headerlink" href="#centroid-calculation" title="Permalink to this headline">¶</a></h3>
<p>Sometimes it is useful to summarize a polygon into a single point and, for that, a good candidate is its centroid (almost like a spatial analogue of the average). The following command will return a <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> (a single column with spatial data) with the centroids of a polygon <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cents</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">centroid</span>
<span class="n">cents</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    POINT (386147.759 4204605.994)
1    POINT (216296.159 4579397.331)
2    POINT (688901.588 4180201.774)
3    POINT (518262.028 4069898.674)
4    POINT (206940.936 4127361.966)
dtype: geometry
</pre></div>
</div>
</div>
</div>
<p>Note how <code class="docutils literal notranslate"><span class="pre">cents</span></code> is not an entire table but a single column, or a <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> object. This means you can plot it directly, just like a table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cents</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_84_1.png" src="../../_images/lab_C_84_1.png" />
</div>
</div>
<p>But you don’t need to call a <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column to inspect the spatial objects. In fact, if you do it will return an error because there is not any <code class="docutils literal notranslate"><span class="pre">geometry</span></code> column, the object <code class="docutils literal notranslate"><span class="pre">cents</span></code> itself is the geometry.</p>
</div>
<div class="section" id="point-in-polygon-pip">
<h3>Point in polygon (PiP)<a class="headerlink" href="#point-in-polygon-pip" title="Permalink to this headline">¶</a></h3>
<p>Knowing whether a point is inside a polygon is conceptually a straightforward exercise but computationally a tricky task to perform. The way to perform this operation in <code class="docutils literal notranslate"><span class="pre">GeoPandas</span></code> is through the <code class="docutils literal notranslate"><span class="pre">contains</span></code> method, available for each polygon object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">112</span><span class="p">,</span> <span class="s2">&quot;geometry&quot;</span><span class="p">]</span>
<span class="n">pt1</span> <span class="o">=</span> <span class="n">cents</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pt2</span> <span class="o">=</span> <span class="n">cents</span><span class="p">[</span><span class="mi">112</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>And we can perform the checks as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pt1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">poly</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pt2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Performing point-in-polygon in this way is instructive and useful for pedagogical reasons, but for cases with many points and polygons, it is not particularly efficient. In these situations, it is much more advisable to perform then as a “spatial join”. If you are interested in these, see the link provided below to learn more about them.</p>
</div>
<div class="section" id="buffers">
<h3>Buffers<a class="headerlink" href="#buffers" title="Permalink to this headline">¶</a></h3>
<p>Buffers are one of the classical GIS operations in which an area is drawn around a particular geometry, given a specific radious. These are very useful, for instance, in combination with point-in-polygon operations to calculate accessibility, catchment areas, etc.</p>
<p>For this example, we will use the bars table, but will project it to the same CRS as <code class="docutils literal notranslate"><span class="pre">cities</span></code>, so it is expressed in metres:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pois_projected</span> <span class="o">=</span> <span class="n">pois</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">cities</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">pois_projected</span><span class="o">.</span><span class="n">crs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Projected CRS: EPSG:25830&gt;
Name: ETRS89 / UTM zone 30N
Axis Info [cartesian]:
- E[east]: Easting (metre)
- N[north]: Northing (metre)
Area of Use:
- name: Europe - 6°W to 0°W and ETRS89 by country
- bounds: (-6.0, 35.26, 0.0, 80.53)
Coordinate Operation:
- name: UTM zone 30N
- method: Transverse Mercator
Datum: European Terrestrial Reference System 1989
- Ellipsoid: GRS 1980
- Prime Meridian: Greenwich
</pre></div>
</div>
</div>
</div>
<p>To create a buffer using <code class="docutils literal notranslate"><span class="pre">geopandas</span></code>, simply call the <code class="docutils literal notranslate"><span class="pre">buffer</span></code> method, passing in the radious. For example, to draw a 500m. buffer around every bar in Zaragoza:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buf</span> <span class="o">=</span> <span class="n">pois_projected</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">buf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>603129991    POLYGON ((676071.164 4612191.116, 676068.756 4...
673807647    POLYGON ((675740.197 4612333.309, 675737.789 4...
759470843    POLYGON ((676083.551 4614558.818, 676081.143 4...
765953540    POLYGON ((675653.012 4611997.279, 675650.604 4...
772973291    POLYGON ((675616.277 4614955.710, 675613.870 4...
dtype: geometry
</pre></div>
</div>
</div>
</div>
<p>And plotting it is equally straighforward:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Plot buffer</span>
<span class="n">buf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Plot named places on top for reference</span>
<span class="c1"># [NOTE how we modify the dot size (`markersize`)</span>
<span class="c1"># and the color (`color`)]</span>
<span class="n">pois_projected</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="../../_images/lab_C_97_1.png" src="../../_images/lab_C_97_1.png" />
</div>
</div>
</div>
</div>
<div class="section" id="adding-base-layers-from-web-sources">
<h2>Adding base layers from web sources<a class="headerlink" href="#adding-base-layers-from-web-sources" title="Permalink to this headline">¶</a></h2>
<p>Many single datasets lack context when displayed on their own. A common approach to alleviate this is to use web tiles, which are a way of quickly obtaining geographical context to present spatial data. In Python, we can use <a class="reference external" href="https://contextily.readthedocs.io"><code class="docutils literal notranslate"><span class="pre">contextily</span></code></a> to pull down tiles and display them along with our own geographic data.</p>
<p>We can begin by creating a map in the same way we would do normally, and then use the <code class="docutils literal notranslate"><span class="pre">add_basemap</span></code> command to, er, add a basemap:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">cities</span><span class="o">.</span><span class="n">crs</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_99_0.png" src="../../_images/lab_C_99_0.png" />
</div>
</div>
<p>Note that we need to be explicit when adding the basemap to state the coordinate reference system (<code class="docutils literal notranslate"><span class="pre">crs</span></code>) our data is expressed in, <code class="docutils literal notranslate"><span class="pre">contextily</span></code> will not be able to pick it up otherwise. Conversely, we could change our data’s CRS into <a class="reference external" href="http://epsg.io/3857">Pseudo-Mercator</a>, the native reference system for most web tiles:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cities_wm</span> <span class="o">=</span> <span class="n">cities</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3857</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">cities_wm</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_101_0.png" src="../../_images/lab_C_101_0.png" />
</div>
</div>
<p>Note how the coordinates are different but, if we set it right, either approach aligns tiles and data nicely.</p>
<p>Web tiles can be integrated with other features of maps in a similar way as we have seen above. So, for example, we can change the size of the map, and remove the axis. Let’s use Zaragoza for this example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">zgz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">zgz</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_104_0.png" src="../../_images/lab_C_104_0.png" />
</div>
</div>
<p>Now, <code class="docutils literal notranslate"><span class="pre">contextily</span></code> offers a lot of options in terms of the sources and providers you can use to create your basemaps. For example, we can use satellite imagery instead:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">zgz</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cx</span><span class="o">.</span><span class="n">add_basemap</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> 
               <span class="n">crs</span><span class="o">=</span><span class="n">zgz</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span>
               <span class="n">source</span><span class="o">=</span><span class="n">cx</span><span class="o">.</span><span class="n">providers</span><span class="o">.</span><span class="n">Esri</span><span class="o">.</span><span class="n">WorldImagery</span>
              <span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/lab_C_106_0.png" src="../../_images/lab_C_106_0.png" />
</div>
</div>
<p>Have a look at this Twitter thread to get some further ideas on providers:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output text_html">
<blockquote class="twitter-tweet" data-lang="en"><p lang="et" dir="ltr">Terrain maps <a href="https://t.co/VtN9bGG5Mt">pic.twitter.com/VtN9bGG5Mt</a></p>&mdash; Dani Arribas-Bel (@darribas) <a href="https://twitter.com/darribas/status/1157297596689539072?ref_src=twsrc%5Etfw">August 2, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div></div>
</div>
<p>And consider checking out the documentation website for the package:</p>
<blockquote>
<div><p><a class="reference external" href="https://contextily.readthedocs.io/en/latest/">https://contextily.readthedocs.io/en/latest/</a></p>
</div></blockquote>
</div>
<div class="section" id="interactive-maps">
<h2>Interactive maps<a class="headerlink" href="#interactive-maps" title="Permalink to this headline">¶</a></h2>
<p>Everything we have seen so far relates to static maps. These are useful for publication, to include in reports or to print. However, modern web technologies afford much more flexibility to explore spatial data interactively.</p>
<p>One of the most prominents examples of interactive maps integrated with notebooks is <a class="reference external" href="https://kepler.gl/">Kepler.GL</a>. Using its Jupyter integration, we can easily convert data (expressed in lon/lat) into interactive maps, and then play further to tweak its appearance. In this context, we will only show how you can take a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> into an interactive map in two lines of code:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: this may not render on the website</span>

<span class="c1"># Create a new map</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">KeplerGl</span><span class="p">()</span>
<span class="c1"># Append your data in lon/lat</span>
<span class="n">m</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">streets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Streets&quot;</span><span class="p">)</span>
<span class="c1"># Display</span>
<span class="n">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User Guide: https://docs.kepler.gl/docs/keplergl-jupyter
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/lib/python3.7/site-packages/geopandas/geodataframe.py:852: UserWarning: Geometry column does not contain geometry.
  warnings.warn(&quot;Geometry column does not contain geometry.&quot;)
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "4f4c906bbd4b483796628efea094da54", "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>
<div class="section" id="further-resources">
<h2>Further resources<a class="headerlink" href="#further-resources" title="Permalink to this headline">¶</a></h2>
<p>More advanced GIS operations are possible in <code class="docutils literal notranslate"><span class="pre">geopandas</span></code> and, in most cases, they are extensions of the same logic we have used in this document. If you are thinking about taking the next step from here, the following two operations (and the documentation provided) will give you the biggest <a class="reference external" href="https://en.wikipedia.org/wiki/Bang_for_the_buck">“bang for the buck”</a>:</p>
<ul class="simple">
<li><p>Spatial joins</p></li>
</ul>
<blockquote>
<div><p><a class="reference external" href="https://geopandas.org/mergingdata.html#spatial-joins">https://geopandas.org/mergingdata.html#spatial-joins</a></p>
</div></blockquote>
<ul class="simple">
<li><p>Spatial overlays</p></li>
</ul>
<blockquote>
<div><p><a class="reference external" href="https://geopandas.org/set_operations.html">https://geopandas.org/set_operations.html</a></p>
</div></blockquote>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/bC"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="concepts_C.html" title="previous page">Concepts</a>
    <a class='right-next' id="next-link" href="diy_C.html" title="next page">Do-It-Yourself</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dani Arribas-Bel<br/>
        
          <div class="extra_footer">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">A course on Geographic Data Science</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://darribas.org" property="cc:attributionName" rel="cc:attributionURL">Dani Arribas-Bel</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../../_static/js/index.d3f166471bb80abb5163.js"></script>


    
    <!-- Google Analytics -->
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-6032674-1', 'auto');
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
    <!-- End Google Analytics -->
    
  </body>
</html>